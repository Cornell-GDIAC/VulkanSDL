# VulkanSDL App Creator
---
This directory is a copy of SDL with installation scripts specifically to 
create runnable applications (and not just SDL libraries). The applications 
created will be linked to a private copy of SDL, ensuring that the application 
uses the correct version of SDL at all times. This copy of SDL will be packaged 
with the application deliverable (either as a static library or a bundled 
shared library). While this is often derided as not the Unix way, neither 
Android nor iOS have package managers. In addition, Linux applications are 
going to end up in a Flatpak with their own copy of SDL anyway.

This directory is itself a Python script, whose purpose is to create the 
appropriate IDE project for the application. While CMake is still supported in 
this copy of SDL, mobile applications such as iOS and Anroid need further 
customization not supported by CMake. In addition, the XCode and Visual Studio 
projects generated by this script are significantly cleaner and easier to debug 
than those generated by CMake.

## Project Setup

To use that app creator, you should first have an app directory. This directory 
should contain a YAML configuration file. This file is used to specify the 
location of the following 

- Location of all source code files
- Location of any additional include files
- The application assets (textures, sounds, etc)
- The application icon

Except for the source code files (which must include a `main`), all of these are 
optional. The icon should be specified as a 1024x1024 PNG file.

## Setup Script

The python setup script assumes that the following packages are installed:

- [PyYAML](https://pyyaml.org)
- [Pillow](https://pillow.readthedocs.io/en/stable/)
- [shortuuid](https://pypi.org/project/shortuuid/)

The first two are for reading the configuration file and generating the icon 
assets, respectively. The script will fail if they are not present. The last 
package is for UUID generation for XCode projects. Without it, generated XCode 
projects will have weaker uniqueness guarantees on their UUIDs.

To create a VulkanSDL application, run this folder as a python program as 
follows

    python sdl2 <project>

where `project` is a directory containing `config.yml`. This is a YAML 
configuration file describing all of the application properties. See the 
provided demos for an explanation of the various settings. 

Most build options are specified in the config file. However, the script does 
support some command line arguments as well. They are as follows.

- `-b, --build `   The build directory
- `-c, --config`   The configuration file
- `-t, --target`   The active build target

The latter option can be used to specify a single build target. It can be one 
of `android`, `apple`, `macos`, `ios`, `windows` or `cmake`. The `cmake` option 
supports all of the platforms that SDL does, though we have only tested it 
against Linux and the platforms listed above. We have also made minor 
modifications to the default SDL CMake file.  

All options other than `cmake` create an IDE project for the given platform.
For example, `android` creates an Android Studio project while `ios` or `macos` 
create an XCode project. The `windows` option creates a Visual Studio project. 
All projects are fully configured and ready to run.

We also have a `flatpak` option. This is a project built on top of CMake for 
packaging x86 Linux builds for rapid deployment on the Steam Deck.  See the
readme in the `cmake` build folder for your project for how to package
with flatpak.

## Project Includes

Because we are building SDL and its extensions by source, it would break the 
code to put the headers inside of a folder called `SDL` (as SDL source code 
does not use angle brackets and instead expects these headers to be in folder 
called `include`). Hence all SDL headers should be included directly without 
a prefix. In other words

```
#include <SDL.h>     // Correct
#include <SDL/SDL.h> // Incorrect
```

It is possible to solve this problem by duplicating the headers, creating a 
second include directory. But seeing as the headers for SDL are almost 3 MB, 
we opted not to do this.

In an attempt at compatibility, you can add a symbolic link named `SDL` in 
the `extras` directory, which is the secondary include directory. As symbolic
links are OS dependent, it is not installed automatically. You can install it
by calling the python script with the flag `-s, --symlink ` with no arguments.

All other headers should be included normally.

## Project Suffix

One of the least understood aspects of the config file is the project suffix. 
The `appid` is used to define your application on mobile devices. However, in
the case of iOS, this appid must be **globally unique**. That means that if 
you download a demo that was built under one Apple Developer account (i.e. mine),
it cannot be code signed under another Apple Developer account (i.e. yours).
This can cause all sorts of headaches when trying to deliver demos to students.

The solution is to tack on a unique suffix to the appid. If `suffix` is set
to true, this is exactly what happens. The suffix is a hash generated on the
full path from root to the config file, so technically collisions are possible
on laptops with the same name and same user accounts. But for our purposes,
this does not happen.

More importantly, the first time this setuo script is run, this suffix value
is placed in the config file. From that point on, this is the suffix that is
guaranteed to be used. This is useful for when project teams want to share
the same suffix (as theoretically all students on the team should be working
with the same Apple Developer account). The config file can be committed to 
the repository for all members to share that suffix.

Note that if `suffix` is false, no suffix will be generated. This should only
be used for your own projects that will not be distributed to others.

## Code Signing

Because of the dynamic frameworks used by Vulkan, both the macOS and the iOS 
build require code signing. Fortunately, this can be done with a "personal 
team" even if you do not have an Apple Developer membership. You will need
to set your development team in **Signings & Capabilities** tab in Xcode 
for both the macOS and iOS targets.

## SDL Support

This version of the application creator is built from the following packages:

- SDL2, version 2.30.5
- SDL2-Image, version 2.8.2
- SDL2-TTF, version 2.20.1

For SDL2-Image we enable JPEG, PNG, TIFF and WEBP formats. These are the only 
formats we can build without error on all platforms. For SDL2-TTF, we enable 
both FreeType and Harfbuzz.

## Vulkan Support

The `cmake` builds (including Android) always use the version of Vulkan 
installed on the system. For Visual Studio and Xcode, we have packaged versions
of Vulkan that we have determined to be stable.

- **Windows**: VulkanSDK 1.3.290
- **macOS**: MoltenVK 1.2.5 (newer versions have an issue)
- **iOS**: MoltenVK 1.2.10

Feel free to update these with newer versions of the Vulkan as you see fit. 
Libraries are installed in the following folders:

- `templates/apple/Frameworks`
- `templates/apple/Resources`
- `templates/windows/dlls`
- `templates/windows/libs`

All versions of VulkanSDL use the Vulkan loader (e.g. they do not statically 
link to Vulkan) and provide support for validation layers. We include headers 
for `vma` and `glm` in addition to the Vulkan headers.

Note that we do *not* include SPIRV tools with the build. On some platforms, 
adding SPIRV to your application can add up to 1 GB to your footprint. This 
is completely unacceptable for mobile applications. We assume that you compile
all shaders to bytecode ahead of time using the Vulkan SDK.

